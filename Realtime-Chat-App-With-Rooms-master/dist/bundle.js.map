{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src-server/server-ts.ts","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///external \"socket.io\""],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src-server/server-ts.ts\");\n","export {};\r\n\r\nconst eventNames = {\r\n    new_user: 'new_user',\r\n    room_created: 'room_created',\r\n    user_connected: 'user_connected',\r\n    send_chat_message: 'send_chat_message',\r\n    chat_message: 'chat_message',\r\n    user_disconnected: 'user_disconnected'\r\n};\r\n\r\nconst express = require('express');\r\nconst app = express();\r\nconst server = require('http').createServer(app);//AKA http.\r\nconst io = require('socket.io')(server);\r\n\r\napp.set('views', './views');//set view folder.\r\napp.set('view engine', 'ejs');//set view engine.\r\napp.use(express.static('public'));//use `public` folder to serve client scripts (for accessing from views).\r\napp.use(express.urlencoded({ extended: true }));\r\n\r\nclass User{\r\n}\r\nclass Room{\r\n    users: Record<string, User>\r\n}\r\nconst rooms: Record<string, Room> = { };\r\n\r\napp.get('/', (req, res) => {\r\n    res.render('index', { rooms: rooms })\r\n});\r\n\r\ninterface MyRequest<T> extends Request {\r\n    body: ReadableStream<Uint8Array> & T\r\n}\r\napp.post('/choose-room', (req: MyRequest<{room: any}>, res) => {\r\n    if (rooms[req.body.room] != null) {\r\n        return res.redirect('/')\r\n    }\r\n    rooms[req.body.room] = { users: {} };\r\n    res.redirect(req.body.room);\r\n    // Send message that new room was created\r\n    io.emit(eventNames.room_created, req.body.room)\r\n});\r\n\r\napp.get('/:room', (req, res) => {\r\n    if (rooms[req.params.room] == null) {\r\n        return res.redirect('/')\r\n    }\r\n    res.render('room', { roomName: req.params.room })\r\n});\r\n\r\nserver.listen(3000);\r\n\r\nio.on('connection', socket => {\r\n    console.log(`someone connected, socket=${JSON.stringify(socket)}`);\r\n    socket.on(eventNames.new_user, (room, name) => {\r\n        socket.join(room);\r\n        rooms[room].users[socket.id] = name;\r\n        socket.to(room).broadcast.emit(eventNames.user_connected, name)\r\n    });\r\n    socket.on(eventNames.send_chat_message, (room, message) => {\r\n        if(message == 'secret1'){console.log(`secret message: ${message}`);}\r\n        socket.to(room).broadcast.emit(eventNames.chat_message, { message: message, name: rooms[room].users[socket.id] })\r\n    });\r\n    socket.on('disconnect', () => {\r\n        getUserRooms(socket).forEach(room => {\r\n            socket.to(room).broadcast.emit(eventNames.user_disconnected, rooms[room].users[socket.id]);\r\n            delete rooms[room].users[socket.id]\r\n        })\r\n    })\r\n});\r\n\r\nfunction getUserRooms(socket) {\r\n    return Object.entries(rooms).reduce((names, [name, room]) => {\r\n        // @ts-ignore\r\n        if (room.users[socket.id] != null) names.push(name);\r\n        return names\r\n    }, [])\r\n}\r\n\r\n\r\n//test crash:\r\napp.get('/crash', (req, res) => {\r\n    throw new Error(\"NTS: Intentional Error !\");\r\n});\r\n\r\n\r\n//ts playground:\r\nclass Car{\r\n    userst: string[];\r\n    roomx: number;\r\n    isSlow: boolean;\r\n    [\"not-in-use-yet\"]: boolean;\r\n}\r\n// try nameof :\r\nconst nameof = <T>(name: Extract<keyof T, string>): string => name;\r\nlet somename = nameof<Car>(\"userst\");\r\nconsole.log(somename);\r\nlet somename2 = nameof<Car>(\"isSlow\");\r\nconsole.log(somename2);\r\nlet somename3 = nameof<Car>(\"not-in-use-yet\");\r\nconsole.log(somename3);\r\n","module.exports = require(\"express\");","module.exports = require(\"http\");","module.exports = require(\"socket.io\");"],"sourceRoot":""}